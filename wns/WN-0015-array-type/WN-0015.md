# WN 0015 - Arrays

- **Status**: *Draft*
- **Discussions-To:**  [Slack/malloy-language](https://malloy-community.slack.com/archives/C06JR0C23RB/p1722981665815069)
- **Author:** Michael Toy\<michaeltoy@meta.com>
- **Experiment-ID:** _arrays_

# Array Gestures

In malloy right now, for scalar arrays "arrayName" refers to the entire array amd "arrayName.value" refers to the un-nested set of values

We need to ...

* Reference the entire array as an object to pass to functions and `select:`
* Reference a particular ntry as an object
* Do aggregate computations on the entire array
* Various other array operations which could be done with function calls or special syntax

But we have to somehow rhyme with arrays of records, you'd like to be able to sum `structArray.value.recordField.value` for example,
but that syntax isn't super happy making

## One Idea

* There are functions for split and join and other things which make or take arrays

* There are ton of `[]` based syntaxes for most basic things

For these examples, imagine a schema with an array of integers `intArray`, and an array of records `recArray` which have an array of integers `innerInts`.

### Basic Access

| Expression | Meaning |
| --- | --- |
| `intArray` | The entire array as an object |
| `intArray[]` | One un-nested value from intArray |
| `intArray[n]` | The element at index `n` in the array |
| `intArray[n to p]` | Range pased slice, starting a index `n` and ending at `p` |
| `intArray[n, x]` | Slice starting at index `n` for length `x` |
| `intArray[n to ...]` | Slice starting at `n` and going to the end |
| `intArray[n, ...]` | Slice starting at `n` and going to the end |

### Aggregate Expressions

I am losing brain sharpness to know if "word.aggregate" always implies word[],
but since inside of a `source.aggFunc(...)` I want the `[]` to make it clear
this is an un-nest, does that mean I should require `[]` everywhere to be an unnest?

| Expression | Meaning |
| --- | --- |
| `intArray[].sum()` | Sum of all elements |
| `sum(intArray[]` / otherField) | Use unnested value in computation |
| `recArray[].avg(innerInts[].sum())` | Average value of the sums of all the ints

### Maybe

See what other operators can use arrays

| Expression | Meaning |
| --- | --- |
| `x + y` | Concatenate |
| ... | Probbaly don't want to do "contains" because you really want the index |
| ... | look at javascript array functions and see what else could be an operator? |


### Casting?

For sql-native functions we'll need type casts for arrays.
