# WN 0004 - SQL in Dimensions

- **Status**: *Draft* 
- **Discussions-To:**  https://github.com/malloydata/malloy/discussions/1423, slack, gchat
- **Author:** lloyd tabb, Chris Swenson

There are cases where we simply cannot write the SQL expression required.  For example, currently Malloy does not support coorelated subqueries or the ability to call certain functions. 

LookML models are entirely based on this mechanism.  As much as possible, we should try and be compatible with LookML SQL expressions.

SQL expressions are always dimensions.

Assume a table with the following structure

orders:
```
order_id
order_time
shipped_time
status
user_id
items []
  product_id
  product_description
  sale_price
  is_returned
  product_category
```

## Coorelated Subquery Example
Malloy currently does not support coorelated subqueries.  Coorelated subqueries on nested data are more efficient than joining nested data.

The code below returns the count of items that have not been returned.  

`${TABLE}` references the root alias for the source.  

The `!number` lets us know that the return type from sql expression is a number.  

```
source: orders is bigquery.table(...) extend {

  dimension: item_count is sql!number("""
    (
      SELECT count(*) from UNNEST(${TABLE}.items) 
      WHERE not is_returned
    )
    """)
}
```


